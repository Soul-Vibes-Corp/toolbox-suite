<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Cosmic Snake</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

        :root {
            --bg-color: #0a0f1e;
            --grid-color: rgba(173, 216, 230, 0.1);
            --snake-color: #a3e6ff;
            --food-color: #ffcf4d; /* Stardust Gold */
            --text-color: #e0f2fe;
            --primary-glow: rgba(163, 230, 255, 0.7);
            --secondary-glow: rgba(255, 207, 77, 0.8);
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .game-wrapper {
            background: linear-gradient(145deg, #1c233a, #111625);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), inset 0 0 15px rgba(163, 230, 255, 0.1);
            border: 2px solid rgba(163, 230, 255, 0.2);
            text-align: center;
        }

        .score-display {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 8px var(--primary-glow), 0 0 15px var(--primary-glow);
        }

        canvas {
            background-color: #050810;
            display: block;
            border-radius: 1rem;
            box-shadow: 0 0 15px var(--primary-glow), inset 0 0 10px rgba(0,0,0,0.5);
            border: 1px solid var(--primary-glow);
        }

        .modal {
            display: flex;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(10, 15, 30, 0.8);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(145deg, #1c233a, #111625);
            padding: 2.5rem 4rem;
            border: 2px solid var(--primary-glow);
            border-radius: 1rem;
            text-align: center;
            box-shadow: 0 0 30px var(--primary-glow);
        }
        
        .modal-title {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 10px var(--primary-glow), 0 0 20px var(--secondary-glow);
        }
        
        .modal-text {
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .action-button {
            background: linear-gradient(45deg, var(--food-color), #87CEEB);
            color: #0a0f1e;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px var(--secondary-glow);
            text-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        
        .action-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px var(--secondary-glow), 0 0 10px var(--primary-glow);
        }
    </style>
</head>
<body>

<div class="game-wrapper">
    <div class="score-display">SCORE: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>
</div>

<div id="startModal" class="modal">
    <div class="modal-content">
        <h2 class="modal-title">COSMIC SNAKE</h2>
        <p class="modal-text">Use Arrow Keys or Swipe to Play</p>
        <button id="startBtn" class="action-button">START</button>
    </div>
</div>

<div id="gameOverModal" class="modal" style="display: none;">
    <div class="modal-content">
        <h2 class="modal-title">GAME OVER</h2>
        <p class="modal-text">Final Score: <span id="finalScore">0</span></p>
        <button id="restartBtn" class="action-button">PLAY AGAIN</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    
    const startModal = document.getElementById('startModal');
    const gameOverModal = document.getElementById('gameOverModal');
    const finalScoreEl = document.getElementById('finalScore');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');

    // --- Game Settings ---
    const gridSize = 20;
    let canvasSize = Math.min(window.innerWidth, window.innerHeight) * 0.8;
    canvasSize = Math.floor(canvasSize / gridSize) * gridSize;
    canvas.width = canvasSize;
    canvas.height = canvasSize;

    const tileCount = canvas.width / gridSize;

    // --- Game State ---
    let snake = [{ x: 10, y: 10 }];
    let food = { x: 15, y: 15 };
    let dx = 0;
    let dy = 0;
    let score = 0;
    let changingDirection = false;
    let gameSpeed = 120;
    let gameLoop;
    let gameRunning = false;

    // --- Sound Effects ---
    const eatSound = new Tone.Synth({
        oscillator: { type: 'triangle' },
        envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 }
    }).toDestination();
    const gameOverSound = new Tone.Synth({
        oscillator: { type: 'sine' },
        envelope: { attack: 0.01, decay: 0.5, sustain: 0, release: 0.2 }
    }).toDestination();

    // --- Game Logic ---
    function main() {
        if (!gameRunning) return;

        gameLoop = setTimeout(() => {
            changingDirection = false;
            clearCanvas();
            drawFood();
            moveSnake();
            if(gameRunning) {
                drawSnake();
                main();
            }
        }, gameSpeed);
    }

    function startGame() {
        if (Tone.context.state !== 'running') {
            Tone.context.resume();
        }
        snake = [{ x: 10, y: 10 }];
        dx = 0;
        dy = 0;
        score = 0;
        gameSpeed = 120;
        scoreEl.textContent = 0;
        gameRunning = true;
        startModal.style.display = 'none';
        gameOverModal.style.display = 'none';
        generateFood();
        main();
    }
    
    function endGame() {
        gameRunning = false;
        clearTimeout(gameLoop);
        gameOverSound.triggerAttackRelease('C3', '8n');
        finalScoreEl.textContent = score;
        gameOverModal.style.display = 'flex';
    }

    function clearCanvas() {
        ctx.fillStyle = '#050810';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.beginPath();
        for (let x = 0; x <= canvas.width; x += gridSize) {
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
        }
        for (let y = 0; y <= canvas.height; y += gridSize) {
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
        }
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid-color').trim();
        ctx.stroke();
    }
    
    // --- Drawing Functions ---
    function drawSnakePart(snakePart) {
        const x = snakePart.x * gridSize;
        const y = snakePart.y * gridSize;
        const snakeColor = getComputedStyle(document.documentElement).getPropertyValue('--snake-color').trim();

        ctx.fillStyle = snakeColor;
        ctx.shadowColor = snakeColor;
        ctx.shadowBlur = 10;
        ctx.fillRect(x + 2, y + 2, gridSize - 4, gridSize - 4);
        ctx.shadowBlur = 0;
    }

    function drawSnake() {
        snake.forEach(drawSnakePart);
    }

    function drawFood() {
        const x = food.x * gridSize + gridSize / 2;
        const y = food.y * gridSize + gridSize / 2;
        const radius = gridSize / 2 - 2;
        const foodColor = getComputedStyle(document.documentElement).getPropertyValue('--food-color').trim();
        
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = foodColor;
        ctx.shadowColor = foodColor;
        ctx.shadowBlur = 15;
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    // --- Movement & Collision ---
    function moveSnake() {
        const head = { x: snake[0].x + dx, y: snake[0].y + dy };
        snake.unshift(head);

        if (didGameEnd(head)) {
            endGame();
            return;
        }

        const didEatFood = snake[0].x === food.x && snake[0].y === food.y;
        if (didEatFood) {
            score += 10;
            eatSound.triggerAttackRelease('G5', '8n');
            scoreEl.textContent = score;
            gameSpeed = Math.max(50, gameSpeed - 2);
            generateFood();
        } else {
            snake.pop();
        }
    }

    function didGameEnd(head) {
        for (let i = 4; i < snake.length; i++) {
            if (snake[i].x === head.x && snake[i].y === head.y) return true;
        }
        const hitLeftWall = head.x < 0;
        const hitRightWall = head.x >= tileCount;
        const hitTopWall = head.y < 0;
        const hitBottomWall = head.y >= tileCount;
        return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
    }

    function generateFood() {
        food.x = Math.floor(Math.random() * tileCount);
        food.y = Math.floor(Math.random() * tileCount);
        snake.forEach(part => {
            if (part.x === food.x && part.y === food.y) {
                generateFood();
            }
        });
    }

    // --- Control Handling ---
    function changeDirection(event) {
        if (changingDirection || !gameRunning) return;
        
        const keyPressed = event.keyCode;
        const goingUp = dy === -1;
        const goingDown = dy === 1;
        const goingRight = dx === 1;
        const goingLeft = dx === -1;

        if ((keyPressed === 37 || keyPressed === 65) && !goingRight) { dx = -1; dy = 0; changingDirection = true;} // Left or A
        if ((keyPressed === 38 || keyPressed === 87) && !goingDown) { dx = 0; dy = -1; changingDirection = true;}  // Up or W
        if ((keyPressed === 39 || keyPressed === 68) && !goingLeft) { dx = 1; dy = 0; changingDirection = true;}   // Right or D
        if ((keyPressed === 40 || keyPressed === 83) && !goingUp) { dx = 0; dy = 1; changingDirection = true;}    // Down or S
    }

    // --- Mobile Swipe Controls ---
    let touchStartX = 0, touchStartY = 0;

    function handleSwipe(e) {
        if (changingDirection || !gameRunning) return;
        
        const touchEndX = e.changedTouches[0].screenX;
        const touchEndY = e.changedTouches[0].screenY;
        const deltaX = touchEndX - touchStartX;
        const deltaY = touchEndY - touchStartY;
        
        if (Math.abs(deltaX) < 10 && Math.abs(deltaY) < 10) return; // Ignore taps

        const goingUp = dy === -1;
        const goingDown = dy === 1;
        const goingRight = dx === 1;
        const goingLeft = dx === -1;

        if (Math.abs(deltaX) > Math.abs(deltaY)) {
            if (deltaX > 0 && !goingLeft) { dx = 1; dy = 0; }
            else if (deltaX < 0 && !goingRight) { dx = -1; dy = 0; }
        } else {
            if (deltaY > 0 && !goingUp) { dx = 0; dy = 1; }
            else if (deltaY < 0 && !goingDown) { dx = 0; dy = -1; }
        }
        changingDirection = true;
    }

    canvas.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }, { passive: false });

    canvas.addEventListener('touchend', handleSwipe, { passive: false });


    document.addEventListener("keydown", changeDirection);
    startBtn.addEventListener('click', startGame);
    restartBtn.addEventListener('click', startGame);
</script>

</body>
</html>

